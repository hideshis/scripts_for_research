<!DOCTYPE html>
<html>
<head>
  <title>BaseXServlet.java</title>
  <meta http-equiv='Content-Type' content='text/html; charset=UTF-8'/>
  <link rel='stylesheet' type='text/css' href='../../../coverage.css'/>
  <link rel='shortcut icon' type='image/png' href='../../../logo.png'/>
  <script type='text/javascript' src='../../../coverage.js'></script>
  <script type='text/javascript' src='../../../prettify.js'></script>
</head>
<body onload='prettyPrint()'>
  <table cellpadding='0' cellspacing='1'>
    <caption>basex-api/src/main/java/org/basex/http/BaseXServlet.java</caption>
    <tr>
      <td class='line'>1</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>package org.basex.http;</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td><pre class='imports prettyprint' onclick='showHideLines(this)'><div>import static javax.servlet.http.HttpServletResponse.*;
import static org.basex.http.HTTPText.*;

import java.io.*;
import java.util.*;

import javax.servlet.*;
import javax.servlet.http.*;

import org.basex.core.*;
import org.basex.core.StaticOptions.*;
import org.basex.core.jobs.*;
import org.basex.http.restxq.*;
import org.basex.query.*;
import org.basex.server.*;
import org.basex.util.*;
</div><span>import ...</span></pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>/**
 * &lt;p>Base class for all servlets.&lt;/p>
 *
 * @author BaseX Team 2005-16, BSD License
 * @author Christian Gruen
 */</div><span>/*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>26</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l26s0'>public abstract class BaseXServlet extends HttpServlet {</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>27</td><td>&nbsp;</td>
      <td><pre class='comment'>  /** Servlet-specific user. */</pre></td>
    </tr>
    <tr>
      <td class='line'>28</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l28s0'>  String username = "";</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>29</td><td>&nbsp;</td>
      <td><pre class='comment'>  /** Servlet-specific password. */</pre></td>
    </tr>
    <tr>
      <td class='line'>30</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l30s0'>  String password = "";</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>31</td><td>&nbsp;</td>
      <td><pre class='comment'>  /** Servlet-specific authentication method. */</pre></td>
    </tr>
    <tr>
      <td class='line'>32</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>  AuthMethod auth;</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>34</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>  @Override</pre></td>
    </tr>
    <tr>
      <td class='line'>35</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>  public void init(final ServletConfig config) throws ServletException {</pre></td>
    </tr>
    <tr>
      <td class='line'>36</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l36s0'>    super.init(config);</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>37</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>    try {</pre></td>
    </tr>
    <tr>
      <td class='line'>38</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l38s0'>      HTTPContext.init(config.getServletContext());</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>39</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l39s0'>      final Enumeration&lt;String> en = config.getInitParameterNames();</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>40</td><td class='count'>2</td>
      <td><pre class='prettyprint jmp'>      <span id='l40s0' title='Executions: 2' class='covered cp' onclick='showHide(this,0)'>while(en.hasMoreElements())</span> {</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>41</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l41s0'>        String key = en.nextElement().toLowerCase(Locale.ENGLISH);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>42</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l42s0'>        final String val = config.getInitParameter(key);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>43</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>        <span id='l43s0' title='Executions: 0' class='uncovered'>if(key.startsWith(Prop.DBPREFIX))</span> <span id='l43s1' title='Executions: 0' class='uncovered'>key = key.substring(Prop.DBPREFIX.length());</span></pre>
        <ol style='display:none'></ol>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>44</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>        <span id='l44s0' title='Executions: 0' class='uncovered'>if(key.equalsIgnoreCase(StaticOptions.USER.name()))</span> {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>45</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l45s0'>          username = val;</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>46</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>        <span id='l46s0' title='Executions: 0' class='uncovered'>}</span> else if(key.equalsIgnoreCase(StaticOptions.PASSWORD.name())) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>47</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l47s0'>          password = val;</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>48</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>        <span id='l48s0' title='Executions: 0' class='uncovered'>}</span> else if(key.equalsIgnoreCase(StaticOptions.AUTHMETHOD.name())) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>49</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l49s0'>          auth = AuthMethod.valueOf(val);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>50</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>        }</pre></td>
    </tr>
    <tr>
      <td class='line'>51</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l51s0'>      }</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>52</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l52s0'>    } catch(final IOException ex) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>53</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l53s0'>      throw new ServletException(ex);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>54</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l54s0'>    }</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr>
      <td class='line'>55</td><td class='count'>2</td>
      <td><pre class='prettyprint covered cp' onclick='showHide(this)' id='l55s0'>  }</pre>
        <ol style='display:none'>
          <li>org.exquery.ns.RequestTest#start: 24</li>
        </ol>
      </td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>57</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>  @Override</pre></td>
    </tr>
    <tr>
      <td class='line'>58</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>  public final void service(final HttpServletRequest req, final HttpServletResponse res)</pre></td>
    </tr>
    <tr>
      <td class='line'>59</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>      throws IOException {</pre></td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'>61</td><td class='count'>22</td>
      <td><pre class='prettyprint covered' id='l61s0'>    final HTTPContext http = new HTTPContext(req, res, this);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>62</td><td class='count'>22</td>
      <td><pre class='prettyprint covered' id='l62s0'>    final boolean restxq = this instanceof RestXqServlet;</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>63</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>    try {</pre></td>
    </tr>
    <tr>
      <td class='line'>64</td><td class='count'>22</td>
      <td><pre class='prettyprint covered' id='l64s0'>      http.authorize();</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>65</td><td class='count'>22</td>
      <td><pre class='prettyprint covered' id='l65s0'>      run(http);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>66</td><td class='count'>21</td>
      <td><pre class='prettyprint covered' id='l66s0'>      http.log(SC_OK, "");</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>67</td><td class='count'>1</td>
      <td><pre class='prettyprint covered' id='l67s0'>    } catch(final HTTPException ex) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>68</td><td class='count'>1</td>
      <td><pre class='prettyprint covered' id='l68s0'>      http.status(ex.getStatus(), Util.message(ex), restxq);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>69</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l69s0'>    } catch(final LoginException ex) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>70</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l70s0'>      http.status(SC_UNAUTHORIZED, Util.message(ex), restxq);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>71</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l71s0'>    } catch(final IOException | QueryException ex) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>72</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l72s0'>      http.status(SC_BAD_REQUEST, Util.message(ex), restxq);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>73</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l73s0'>    } catch(final JobException ex) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>74</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l74s0'>      http.status(SC_GONE, Text.INTERRUPTED, restxq);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>75</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l75s0'>    } catch(final Exception ex) {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>76</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l76s0'>      final String msg = Util.bug(ex);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>77</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l77s0'>      Util.errln(msg);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>78</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l78s0'>      http.status(SC_INTERNAL_SERVER_ERROR, Util.info(UNEXPECTED, msg), restxq);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>79</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>    } finally {</pre></td>
    </tr>
    <tr>
      <td class='line'>80</td><td class='count'>22</td>
      <td><pre class='prettyprint jmp'>      <span id='l80s0' title='Executions: 22' class='covered'>if(Prop.debug)</span> {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>81</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l81s0'>        Util.outln("_ REQUEST _________________________________" + Prop.NL + req);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>82</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l82s0'>        final Enumeration&lt;String> en = req.getHeaderNames();</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>83</td><td class='count'>0</td>
      <td><pre class='prettyprint jmp'>        <span id='l83s0' title='Executions: 0' class='uncovered'>while(en.hasMoreElements())</span> {</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>84</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l84s0'>          final String key = en.nextElement();</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>85</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l85s0'>          Util.outln(Text.LI + key + Text.COLS + req.getHeader(key));</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>86</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l86s0'>        }</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>87</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l87s0'>        Util.out("_ RESPONSE ________________________________" + Prop.NL + res);</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>88</td><td class='count'>0</td>
      <td><pre class='prettyprint uncovered' id='l88s0'>      }</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr>
      <td class='line'>89</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>    }</pre></td>
    </tr>
    <tr>
      <td class='line'>90</td><td class='count'>22</td>
      <td><pre class='prettyprint covered' id='l90s0'>  }</pre>
        <ol style='display:none'></ol>
      </td>
    </tr>
    <tr><td class='line'></td><td colspan='2'>&nbsp;</td></tr>
    <tr>
      <td class='line'></td><td>&nbsp;</td>
      <td class='comment' onclick='showHideLines(this)'><div>  /**
   * Runs the code.
   * @param http HTTP context
   * @throws Exception any exception
   */</div><span>  /*...*/</span></td>
    </tr>
    <tr>
      <td class='line'>97</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>  protected abstract void run(final HTTPContext http) throws Exception;</pre></td>
    </tr>
    <tr>
      <td class='line'>98</td><td>&nbsp;</td>
      <td><pre class='prettyprint'>}</pre></td>
    </tr>
  </table>
</body>
</html>
